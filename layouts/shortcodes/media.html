{{ $alt := .Get "alt" }}
{{ $caption := .Get "caption" }}
{{ $src := .Get "src" }}
{{ $from := .Get "from" }}

{{ $type := default "image" (.Get "type") }}
{{ $size := default "default" (.Get "size") }}
{{ $noshadow := default "shadow" (.Get "noshadow") }}

{{ $containerClasses := slice "media" "pswp-container" }}
{{ $contentWidths := dict "default" 960 "small" 720 "mini" 480 }}
{{ $generateWidth := default 960 (index $contentWidths $size) }}
{{ if eq $size "default" }}
  {{ $containerClasses = $containerClasses | append "default" }}
{{ end }}

{{ $mediaClasses := slice $size $noshadow }}

{{ if eq $type "placeholder" }}
  {{ $from = "2020-02-07-finding-next"}}
  {{ $src = "terlingua-road.jpg" }}
  {{ $type = "image" }}
{{ end }}

<figure class="{{ delimit $containerClasses " " }}">
  {{ if eq $type "image"}}
    {{ $image := $.Page.Resources.GetMatch $src }}

    <!-- If pulling an image from another post... -->
    {{ if $from }}
      {{ $page := $.Site.GetPage $from }}
      {{ $image = $page.Resources.GetMatch $src }}
    {{ end }}

    <!-- Link to original image, display a preview size... -->
    {{ with $image }}
      <a
        href="{{ .RelPermalink }}"
        data-pswp-width="{{ .Width }}"
        data-pswp-height="{{ .Height }}"
        data-cropped="true"
      >
        {{ $preview := $image.Fit (printf "%dx%d" $generateWidth $generateWidth) }}
        <img
          src="{{ $preview.RelPermalink }}"
          class="{{ delimit $mediaClasses " " }}"
          alt="{{ $alt }}"
          width="{{ $preview.Width }}"
          height="{{ $preview.Height }}"
        />
      </a>
    {{ end }}
  {{ end }}
  {{ if $caption }}
    <figcaption>{{ $caption }}</figcaption>
  {{ end }}
</figure>
