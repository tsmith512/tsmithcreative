version: 1
frontend:
  phases:
    preBuild:
      commands:
        - amazon-linux-extras install epel -y
        - yum install -y --enablerepo=epel vips vips-devel vips-tools
        - yum install -y ImageMagick libpng-devel libwebp-devel libwebp-tools
        - rvm install 2.6.5
        - nvm install 10
    build:
      commands:
        - rvm use 2.6.5
        - nvm use 10
        - gem install bundler -v 1.17.3
        - bundle install --path vendor/bundle
        - npm install -g gulp@3
        - npm install
        - gulp build
        - mkdir _site/fonts
        - wget $ASSETS_FOLDER/811484.zip
        - unzip 811484.zip -d _site/fonts/

  artifacts:
    baseDirectory: _site
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle
